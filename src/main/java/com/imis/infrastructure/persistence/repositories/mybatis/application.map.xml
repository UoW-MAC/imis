<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.imis.domain.repositories.ApplicationRepository">
	<cache eviction="FIFO" flushInterval="60000" size="512" readOnly="true" />

	<resultMap type="Application" id="applicationResultMap">
	    <result property="applicationId" column="APPLICATION_ID" />
			<result property="applicationStatus" column="application_status" />
			<result property="updateTime" column="update_time" />
			  <association property="student" resultMap="com.imis.domain.repositories.StudentRepository.studentResultMap" ></association>
			  <association property="position" resultMap="com.imis.domain.repositories.PositionRepository.positionResultMap" ></association>
         <association property="employer" resultMap="com.imis.domain.repositories.EmployerRepository.employerResultMap" ></association>
	</resultMap>

	<insert id="positionApply" useGeneratedKeys="false" parameterType="Application" >
	    <selectKey keyProperty="applicationId" resultType="long" order="BEFORE">
	    	select SEQ_APPLICATION.NEXTVAL from dual
	    </selectKey>
    	<![CDATA[
	    	insert into application(application_id,username,position_id,application_status,create_time,update_time)
	    	values(#{applicationId},#{user.userName},#{position.positionId},#{applicationStatus},#{createTime},#{updateTime})
    	]]>
    </insert>
    <update id="acceptCandidate" parameterType="int" >
    <![CDATA[
			 update  application  set  APPLICATION_STATUS=2
   				 where
   				 application_id=#{applicationId}
    ]]>
    </update>
     <update id="rejectCandidate" parameterType="int" >
    <![CDATA[
			 update  application  set  APPLICATION_STATUS=3
   				 where
   				 application_id=#{applicationId}
    ]]>
    </update>
    <delete id="deleteApplicationInfo" parameterType="Long">
     	<![CDATA[
     		delete from application where application_id = #{applicationId}
     	]]>
	</delete>
	<select id="exportApplicationInfo" resultMap="applicationResultMap">
      SELECT ST.student_no,
        ST.FIRST_NAME,
        ST.MIDDLE_NAME,
        ST.LAST_NAME,
        a.application_status,
         p.position_name,
         e.employer_name
        FROM STUDENT ST , application a,position p,employer e
        where ST.USERNAME=a.username and p.position_id=a.position_id and e.employer_id = p.employer_id
    </select>
</mapper>
